(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();async function k(s){const t=document.querySelectorAll(".human"),e=document.querySelectorAll(".computer"),o=document.querySelectorAll(".human .tiles"),n=document.querySelectorAll(".computer .tiles"),r=document.getElementById("orientation"),l=s.playerFleet.ships,a=s.computerFleet.ships;v(s,a,n),f(t,e,!1),L(r),console.log(r),console.log(s.playerBoard.placeShip);for(let c=0;c<l.length;){let u=l[c];alert(`Commander Place your ${u.name}`);let d=await S(o),h=s.playerBoard.placeShip(u,d.value,r.value);h!==3&&(console.log(h.pos),C(o,h.pos),c++)}}function v(s,t,e){for(let o=0;o<t.length;){console.log(t[o],t.length);let n=t[o],r=Math.floor(Math.random()*e.length),l=Math.floor(Math.random()*2)+1;console.log(r,l),s.computerBoard.placeShip(n,e[r].value,l)!==3&&o++}}function S(s){return new Promise(t=>{function e(o){const n=o.target;s.forEach(r=>r.removeEventListener("click",e)),t(n)}s.forEach(o=>o.addEventListener("click",e))})}function L(s){s.addEventListener("click",()=>{s.value==1?(s.value=2,s.textContent="column"):(s.value=1,s.textContent="row")})}function C(s,t){s.length!=0&&s.forEach(e=>{t.includes(e.value)?e.classList.add("selected"):e.classList.remove("selected")})}const p=document.getElementById("app");function m(s,t,e,o=""){const n=i("div");n.classList.add("board",e),i("button",s*s).forEach((a,c)=>{a.classList.add("tiles",e),a.value=t[c],n.append(a)});const l=i("p");return l.classList.add(e),l.textContent=o,n.style.gridTemplateColumns=`repeat(${s}, 1fr)`,n.style.gridTemplateRows=`repeat(${s}, 1fr)`,p.append(l,n),p}function w(s){const t=i("div");t.classList.add("gameOver");const e=i("div"),o=i("p");o.textContent=`${s.toUpperCase()} WINS`;const n=i("button");n.textContent="Play Again",n.id="start",n.classList.add("start"),e.classList.add("declaration"),e.append(o,n),t.append(e),p.append(t)}function E(s){const t=i("form"),e=i("button",3),o=["row","reset","submit"];for(let n=0;n<o.length;n++)e[n].classList.add(o[n]),e[n].textContent=o[n],t.append(e[n]),n!=2&&(e[n].type="button");e[0].value=1,e[0].id="orientation",p.append(t),k(s),t.addEventListener("submit",n=>{n.preventDefault(),P(s)})}function B(s){const t=i("form"),e=i("input",2),o=i("button");t.classList.add("startScreen");const n=["playerName","boardSize"],r=["Name Commander",10],l=["text","number"];for(let a=0;a<n.length;a++)e[a].classList.add(n[a]),e[a].placeholder=r[a],e[a].type=l[a];e[1].min=8,e[1].max=10,o.classList.add("startButton"),o.textContent="Start",o.type="submit",t.addEventListener("submit",a=>{a.preventDefault(),t.style.display="none",e[1].value==""&&(e[1].value="10");const c=s(e[0].value,e[1].value);E(c)}),t.append(e[0],e[1],o),p.append(t)}function i(s,t=1){if(t===1)return document.createElement(s);{let e=[];for(let o=0;o<t;o++){const n=document.createElement(s);e.push(n)}return e}}function P(s){let t;const e=document.querySelectorAll(".computer .tiles"),o=document.querySelectorAll(".human .tiles"),n=document.querySelectorAll(".human"),r=document.querySelectorAll(".computer");t=!0,l();function l(){f(n,r,t),t?e.forEach(c=>{c.onclick=()=>{a(c)}}):setTimeout(()=>{const c=b(s,o);a(c)},1e3)}function a(c){const u=f(n,r,t),d=F(u,s),h=d.attackFunction(c.value,d.attackFleet);if(h===1){c.classList.contains("selected")&&c.classList.remove("selected"),c.classList.add("hit"),l();return}else h===2&&(c.classList.add("miss"),t=!t);if(d.attackFleet.allShipsSunk()){w(d.opponent.name);return}l()}}function b(s,t){let e;const o=s.playerBoard.board,n=s.playerBoard.attacked;let r=Math.floor(Math.random()*o.length);for(;n.includes(o[r]);){b(s,t);break}return t.forEach(l=>{l.value===o[r]&&(e=l)}),e}function f(s,t,e){return e?(s.forEach(o=>{o.style.display="none"}),t.forEach(o=>{o.style.display="grid"}),1):(s.forEach(o=>{o.style.display="grid"}),t.forEach(o=>{o.style.display="none"}),2)}function F(s,t){if(s===1){const e=t.computerBoard.receiveAttack.bind(t.computerBoard),o=t.computerFleet,n=t.player;return{attackFleet:o,attackFunction:e,opponent:n}}else{const e=t.playerBoard.receiveAttack.bind(t.playerBoard),o=t.playerFleet,n=t.computerPlayer;return{attackFleet:o,attackFunction:e,opponent:n}}}class A{constructor(t,e){this.length=t,this.name=e,this.hitCount=0,this.sunk=!1,this.position=[]}Hit(){return console.log("Hit"),this.hitCount+=1}isSunk(){return this.hitCount===this.length?(console.log("going down"),!0):!1}}class O{constructor(){this.ships=[]}addShip(t){this.ships.push(t)}getShipAt(t){return this.ships.find(e=>e.position.includes(t))}allShipsSunk(){for(let t of this.ships)if(!t.isSunk())return!1;return!0}}function y(s,t){for(const e of Object.values(s))if(e.includes(t))return e}class T{constructor(t){this.board=[],this.rows={},this.columns=[],this.size=t,this.boardSize(),this.row(),this.column(),this.taken=[],this.attacked=[],this.miss=[]}possible_rows=[1,2,3,4,5,6,7,8,9,10];possible_columns=["A","B","C","D","E","F","G","H","I","J"];boardSize(){for(let t=0;t<this.size;t++){const e=this.possible_rows[t];for(let o=0;o<this.size;o++){const n=this.possible_columns[o];this.board.push(String(n+e))}}}row(){this.possible_rows.forEach((t,e)=>{this.rows[e]=[],this.board.forEach(o=>{o.includes(`${t}`)&&this.rows[e].push(o)})})}column(){this.possible_columns.forEach((t,e)=>{this.columns[e]=[],this.board.forEach(o=>{o.includes(`${t}`)&&this.columns[e].push(o)})})}placeShip(t,e,o){let n=[];if(o==1){let r=y(this.rows,e),l=r.findIndex(a=>a===e);if(r.length-l<t.length)return alert("Not enough space to place the ship in this row"),3;for(let a=0;a<t.length;a++){const c=r[l];if(this.taken.includes(c))return alert(`Spot already taken ${c}`),3;n.push(c),l++}this.taken.push(...n),t.position.push(...n)}if(o==2){let r=y(this.columns,e),l=r.findIndex(a=>a===e);if(r.length-l<t.length)return alert("Not enough space to place the ship in this column"),3;for(let a=0;a<t.length;a++){const c=r[l];if(this.taken.includes(c))return alert(`Spot already taken ${c}`),3;n.push(c),l++}this.taken.push(...n),t.position.push(...n)}return{pos:this.taken}}receiveAttack(t,e){if(!this.attacked.includes(t)){let o=e.getShipAt(t);return o?(o.Hit(),o.isSunk(),this.attacked.push(t),1):(this.attacked.push(t),this.miss.push(t),2)}return 3}}class g{constructor(t,e){this.name=t,this.type=e}PlayerFleet(){const t=[5,4,3,3,2],e=["Carrier","Battleship","Cruiser","Submarine","Destroyer"],o=new O;for(let n=0;n<t.length;n++){const r=new A(t[n],e[n]);o.addShip(r)}return o}PlayerGameboard(t){return new T(t)}}function x(s,t){const e=new g(s,"human"),o=e.PlayerFleet();for(;t>10||t<8;){t=prompt("Chose the size of you battle field");break}const n=e.PlayerGameboard(t),r=new g("player2","computer"),l=r.PlayerFleet(),a=r.PlayerGameboard(t),c=m(t,n.board,e.type,"Player Board:"),u=m(t,a.board,r.type,"Computer Board:");return{player:e,playerFleet:o,playerBoard:n,computerPlayer:r,computerBoard:a,computerFleet:l,domPlayerBoard:c,domComputerBoard:u}}document.addEventListener("DOMContentLoaded",N);function N(){B(x)}
