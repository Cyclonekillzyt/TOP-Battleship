(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();async function P(o){const t=document.querySelectorAll(".human"),e=document.querySelectorAll(".computer"),s=document.querySelectorAll(".human .tiles"),n=document.querySelectorAll(".computer .tiles"),r=document.getElementById("orientation"),a=o.playerFleet.ships,c=o.computerFleet.ships;x(o,c,n),w(t,e,!1),O(r);for(let i=0;i<a.length;){let l=a[i];alert(`Commander Place your ${l.name}`);let p=await F(s),u=o.playerBoard.placeShip(l,p.value,r.value);if(u.code===3){alert(u.message);continue}T(s,u.pos),i++}}function x(o,t,e){for(let s=0;s<t.length;){let n=t[s],r=Math.floor(Math.random()*e.length),a=Math.floor(Math.random()*2)+1;o.computerBoard.placeShip(n,e[r].value,a).code!==3&&s++}}function F(o){return new Promise(t=>{function e(s){const n=s.target;o.forEach(r=>r.removeEventListener("click",e)),t(n)}o.forEach(s=>s.addEventListener("click",e))})}function O(o){o.addEventListener("click",()=>{o.value==1?(o.value=2,o.textContent="column"):(o.value=1,o.textContent="row")})}function T(o,t){o.length!=0&&o.forEach(e=>{t.includes(e.value)?e.classList.add("selected"):e.classList.remove("selected")})}const v=document.getElementById("app");function C(o,t,e,s=""){const n=h("div");n.classList.add("board",e),h("button",o*o).forEach((c,i)=>{c.classList.add("tiles",e),c.value=t[i],n.append(c)});const a=h("p");return a.classList.add(e,"boardTitle"),a.textContent=s,n.style.gridTemplateColumns=`repeat(${o}, 1fr)`,n.style.gridTemplateRows=`repeat(${o}, 1fr)`,v.append(a,n),v}function M(o){const t=h("div");t.classList.add("gameOver");const e=h("div"),s=h("p");s.textContent=`${o.toUpperCase()} WINS`;const n=h("button");n.textContent="Play Again",n.id="start",n.classList.add("start"),e.classList.add("declaration"),e.append(s,n),t.append(e),v.append(t)}function N(o){const t=h("form"),e=h("button",3),s=["row","reset","submit"];for(let n=0;n<s.length;n++)e[n].classList.add(s[n]),e[n].textContent=s[n],t.append(e[n]),n!=2&&(e[n].type="button");e[0].value=1,e[0].id="orientation",v.append(t),P(o),t.addEventListener("submit",n=>{n.preventDefault(),_(o),t.style.display="none"})}function I(o){const t=h("form"),e=h("input",2),s=h("button");t.classList.add("startScreen");const n=["playerName","boardSize"],r=["Name Commander",10],a=["text","number"];for(let d=0;d<n.length;d++)e[d].classList.add(n[d]),e[d].placeholder=r[d],e[d].type=a[d];e[1].min=8,e[1].max=10,s.classList.add("startButton"),s.textContent="Start",s.type="submit";const c=h("div");c.classList.add("title-banner");const i={viewBox:"0 0 400 400"},l={id:"curve",d:"M0 200 q 200 -200 400 0",fill:"none",stroke:"none"},p={"font-size":"20","font-weight":"bold",fill:"#00ffcc","font-family":"Orbitron, sans-serif"},u={href:"#curve",startOffset:"50%","text-anchor":"middle",lengthAdjust:"spacingAndGlyphs"},f=k("svg",i),g=k("path",l),m=k("text",p),y=k("textPath",u);f.classList.add("header-text"),y.textContent="Welcome to BattleShip",m.append(y),f.append(g,m),c.append(f),t.addEventListener("submit",d=>{d.preventDefault(),t.style.display="none",c.style.display="none",e[1].value==""&&(e[1].value="10");const b=o(e[0].value,e[1].value);N(b)}),t.append(e[0],e[1],s),v.append(c,t)}function k(o,t){const e=document.createElementNS("http://www.w3.org/2000/svg",o);for(const[s,n]of Object.entries(t))e.setAttribute(s,n);return e}function h(o,t=1){if(t===1)return document.createElement(o);{let e=[];for(let s=0;s<t;s++){const n=document.createElement(o);e.push(n)}return e}}class ${constructor(t,e){this.length=t,this.name=e,this.hitCount=0,this.sunk=!1,this.position=[]}Hit(){return this.hitCount+=1}isSunk(){return this.hitCount===this.length}}class q{constructor(){this.ships=[]}addShip(t){this.ships.push(t)}getShipAt(t){return this.ships.find(e=>e.position.includes(t))}allShipsSunk(){for(let t of this.ships)if(!t.isSunk())return!1;return!0}}function S(o,t){for(const e of o)if(e.includes(t))return e}class G{constructor(t){this.board=[],this.rows=[],this.columns=[],this.size=t,this.boardSize(),this.row(),this.column(),this.taken=[],this.attacked=[],this.miss=[]}possible_rows=[1,2,3,4,5,6,7,8,9,10];possible_columns=["A","B","C","D","E","F","G","H","I","J"];boardSize(){for(let t=0;t<this.size;t++){const e=this.possible_rows[t];for(let s=0;s<this.size;s++){const n=this.possible_columns[s];this.board.push(String(n+e))}}}row(){this.possible_rows.forEach((t,e)=>{this.rows[e]=[],this.board.forEach(s=>{s.includes(`${t}`)&&this.rows[e].push(s)})})}column(){this.possible_columns.forEach((t,e)=>{this.columns[e]=[],this.board.forEach(s=>{s.includes(`${t}`)&&this.columns[e].push(s)})})}placeShip(t,e,s){let n=[];if(s==1){let r=S(this.rows,e),a=r.findIndex(c=>c===e);if(r.length-a<t.length)return{code:3,message:"Not enough space to place the ship in this row"};for(let c=0;c<t.length;c++){const i=r[a];if(this.taken.includes(i))return{code:3,message:`Spot already taken ${i}`};n.push(i),a++}this.taken.push(...n),t.position.push(...n)}if(s==2){let r=S(this.columns,e),a=r.findIndex(c=>c===e);if(r.length-a<t.length)return{code:3,message:"Not enough space to place the ship in this column"};for(let c=0;c<t.length;c++){const i=r[a];if(this.taken.includes(i))return{code:3,message:`Spot already taken ${i}`};n.push(i),a++}this.taken.push(...n),t.position.push(...n)}return{pos:this.taken}}receiveAttack(t,e){if(!this.attacked.includes(t)){let s=e.getShipAt(t);return s?(s.Hit(),s.isSunk(),this.attacked.push(t),1):(this.attacked.push(t),this.miss.push(t),2)}return 3}}class B{constructor(t,e){this.name=t,this.type=e}PlayerFleet(){const t=[5,4,3,3,2],e=["Carrier","Battleship","Cruiser","Submarine","Destroyer"],s=new q;for(let n=0;n<t.length;n++){const r=new $(t[n],e[n]);s.addShip(r)}return s}PlayerGameboard(t){return new G(t)}}function _(o){let t;const e=[],s=document.querySelectorAll(".computer .tiles"),n=document.querySelectorAll(".human .tiles"),r=document.querySelectorAll(".human"),a=document.querySelectorAll(".computer");t=!0,c();function c(l=0,p=""){w(r,a,t),t?s.forEach(u=>{u.onclick=()=>{i(u)}}):setTimeout(()=>{const u=D(o,n,l,p,e);i(u)},1e3)}function i(l){const p=w(r,a,t),u=j(p,o),f=u.attackFunction(l.value,u.attackFleet);if(console.log(l.value),f===1){l.classList.contains("selected")&&l.classList.remove("selected"),l.classList.add("hit"),c(f,l.value);return}else f===2&&(l.classList.add("miss"),t=!t);if(u.attackFleet.allShipsSunk()){M(u.opponent.name);return}c(f,l.value)}}function D(o,t,e,s,n){let r;return n.length===0&&e==2?(r=E(o,t),r):(console.log(s,e),r=H(o,n,s,t,e),r||(r=E(o,t)))}function w(o,t,e){return e?(o.forEach(s=>{s.style.display="none"}),t.forEach(s=>{s.style.display="grid"}),1):(o.forEach(s=>{s.style.display="grid"}),t.forEach(s=>{s.style.display="none"}),2)}function j(o,t){if(o===1){const e=t.computerBoard.receiveAttack.bind(t.computerBoard),s=t.computerFleet,n=t.player;return{attackFleet:s,attackFunction:e,opponent:n}}else{const e=t.playerBoard.receiveAttack.bind(t.playerBoard),s=t.playerFleet,n=t.computerPlayer;return{attackFleet:s,attackFunction:e,opponent:n}}}function H(o,t,e,s,n){console.log(e),!t.includes(e)&&n==1&&t.push(e);const r=t[0],a=o.playerBoard.rows,c=o.playerBoard.columns,i=o.playerBoard.attacked;o.playerBoard.miss;const l=b=>[...s].find(L=>L.value=b),p=(b,L)=>b[b.findIndex(A=>A===e)+L],u=S(a,r),f=S(c,r),g=p(u,-1),m=p(u,1),y=p(f,-1),d=p(f,1);return console.log(g,m,y,d,e,t),g&&!i.includes(g)?l(g):m&&!i.includes(m)?l(m):y&&!i.includes(y)?l(y):d&&!i.includes(d)?l(d):(t.shift(),null)}function E(o,t){const e=o.playerBoard.board,s=o.playerBoard.attacked;let n=Math.floor(Math.random()*e.length);for(;s.includes(e[n]);)n=Math.floor(Math.random()*e.length);return[...t].find(a=>a.value===e[n])}function R(o,t){const e=new B(o,"human"),s=e.PlayerFleet();for(;t>10||t<8;){t=prompt("Chose the size of you battle field");break}const n=e.PlayerGameboard(t),r=new B("player2","computer"),a=r.PlayerFleet(),c=r.PlayerGameboard(t),i=C(t,n.board,e.type,"Player Board"),l=C(t,c.board,r.type,"Computer Board");return{player:e,playerFleet:s,playerBoard:n,computerPlayer:r,computerBoard:c,computerFleet:a,domPlayerBoard:i,domComputerBoard:l}}document.addEventListener("DOMContentLoaded",V);function V(){I(R)}
